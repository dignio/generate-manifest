name: Create the Kubernetes manifest
description: This action will create the Kubernetes manifest by using cdk8s. By doing this we do not have to create manifests manually for our applications.
inputs:
  app_name:
    description: The application name
    required: true
    default: ''
  service_type:
    description: Service type selector. I.e. webservice.
    required: true
    default: ''
  instance:
    description: The instance we want to build the manifest for. I.e. development.
    required: true
  namespace:
    description: The Kubernetes namespace
    required: true
    default: development
  docker_image:
    description: The full docker image with tag. <url>/<repo>:<tag>
    required: true
    default: ''
  healthcheck_path:
    description: The application health check path
    required: false
    default: '/'
  port:
    description: The exposed port number used by the application
    required: false
    default: '80'
  container_port:
    description: The internal port used by the application
    required: false
    default: '80'
  container_size:
    description: The size of the container. CPU/Memory. small|medium|large|xlarge
    required: false
    default: ''
  container_command:
    description: The command to be passed to the docker container "['curl']"
    required: false
    default: ''
  container_args:
    description: The args to be passed to the docker container "['-I', 'https://www.google.com']"
    required: false
    default: ''
  replicas:
    description: Define how many replicas you need
    required: false
    default: '1'
  secretsmanager:
    description: Enable secrets manager. To fetch secrets you have to provide the cluster name.
    required: false
    default: 'false'
  cluster_name:
    description: The clustername
    required: false
    default: ''
  ingress:
    description: Should the application have an ingress of its own? Ask devex.
    required: false
    default: 'false'
  ingress_path:
    description: The application root URL path
    required: false
    default: '/'
  ingress_host:
    description: The host name of the application. I.e. prevent.dev.dignio.dev
    required: false
    default: ''
runs:
  using: docker
  image: Dockerfile
  args:
    - ${{ inputs.app_name }}
    - ${{ inputs.service_type }}
    - ${{ inputs.instance }}
    - ${{ inputs.namespace }}
    - ${{ inputs.docker_image }}
    - ${{ inputs.healthcheck_path }}
    - ${{ inputs.replicas }}
    - ${{ inputs.port }}
    - ${{ inputs.container_port }}
    - ${{ inputs.container_size }}
    - ${{ inputs.secretsmanager }}
    - ${{ inputs.cluster_name }}
    - ${{ inputs.ingress }}
    - ${{ inputs.ingress_path }}
    - ${{ inputs.ingress_host }}
